import { createContext, useContext, useMemo, useState, useEffect, ReactNode } from 'react';

type LanguageCode = 'tr' | 'en';

type Messages = Record<string, string>;

type I18nContextValue = {
  lang: LanguageCode;
  t: (key: string) => string;
  setLanguage: (lang: LanguageCode) => void;
};

const messages: Record<LanguageCode, Messages> = {
  tr: {
    'common.loading': 'Yükleniyor...',
    'common.language': 'Dil',
    'common.light': 'Açık',
    'common.dark': 'Koyu',
    'header.newTask': 'Yeni Görev',
    'header.profile': 'Profil',
    'header.settings': 'Ayarlar',
    'header.notifications': 'Bildirimler',
    'header.help': 'Yardım',
    'header.logout': 'Çıkış Yap',
    'sidebar.list': 'Liste',
    'sidebar.board': 'Kanban',
    'sidebar.calendar': 'Takvim',
    'sidebar.stats': 'İstatistikler',
    'sidebar.total': 'Toplam',
    'sidebar.completed': 'Tamamlandı',
    'sidebar.inProgress': 'Devam Ediyor',
    'sidebar.todo': 'Yapılacak',
    'settings.title': 'Ayarlar',
    'settings.language': 'Dil',
    'settings.theme': 'Tema',
    'settings.defaultView': 'Varsayılan Görünüm',
    'settings.defaultViewHelp': 'Seçtiğiniz görünüm hemen uygulanır ve sonraki girişleriniz için kaydedilir.',
    'settings.notifications': 'Bildirimler',
    'settings.security': 'Güvenlik',
    'settings.reports.weekly': 'Haftalık Raporlar',
    'settings.push': 'Push Bildirimleri',
    'settings.email': 'E-posta Hatırlatıcıları',
    'notifications.title': 'Bildirimler',
    'notifications.total': 'Toplam',
    'notifications.unread': 'Okunmamış',
    'notifications.empty': 'Görüntülenecek bildirim yok.',
    'notifications.onlyUnread': 'Yalnızca okunmamış',
    'notifications.all': 'Tümü',
    'notifications.markAllRead': 'Tümünü okundu işaretle',
    'notifications.markRead': 'Okundu işaretle',
    'notifications.markUnread': 'Okunmadı yap',
    'filter.searchPlaceholder': 'Görevlerde ara...',
    'filter.filters': 'Filtreler',
    'filter.status': 'Durum',
    'filter.priority': 'Öncelik',
    'filter.date': 'Tarih',
    'filter.status.all': 'Tüm Durumlar',
    'filter.status.todo': 'Yapılacak',
    'filter.status.inProgress': 'Devam Ediyor',
    'filter.status.completed': 'Tamamlandı',
    'kanban.todo': 'Yapılacak',
    'kanban.inProgress': 'Devam Ediyor',
    'kanban.completed': 'Tamamlandı',
    'filter.priority.all': 'Tüm Öncelikler',
    'filter.priority.high': 'Yüksek',
    'filter.priority.medium': 'Orta',
    'filter.priority.low': 'Düşük',
    'filter.date.all': 'Tüm Tarihler',
    'filter.date.today': 'Bugün',
    'filter.date.week': 'Bu Hafta',
    'filter.date.month': 'Bu Ay',
    'taskModal.newTitle': 'Yeni Görev',
    'taskModal.editTitle': 'Görev Düzenle',
    'taskModal.field.title': 'Görev Başlığı',
    'taskModal.field.description': 'Açıklama',
    'taskModal.field.priority': 'Öncelik',
    'taskModal.field.status': 'Durum',
    'taskModal.field.dueDate': 'Bitiş Tarihi',
    'taskModal.field.category': 'Kategori',
    'taskModal.placeholder.title': 'Görev başlığını girin...',
    'taskModal.placeholder.description': 'Görev açıklamasını girin...',
    'taskModal.placeholder.category': 'Kategori girin...',
    'taskModal.placeholder.selectPriority': 'Öncelik seçin',
    'taskModal.placeholder.selectStatus': 'Durum seçin',
    'taskModal.error.titleRequired': 'Görev başlığı gereklidir',
    'taskModal.error.dueDateRequired': 'Bitiş tarihi gereklidir',
    'taskModal.error.priorityRequired': 'Öncelik seçilmelidir',
    'taskModal.error.statusRequired': 'Durum seçilmelidir',
    'taskModal.cancel': 'İptal',
    'taskModal.create': 'Oluştur',
    'taskModal.update': 'Güncelle',
    'task.delete.title': 'Görevi silmek istediğinize emin misiniz?',
    'task.delete.subtitle': 'Bu işlem geri alınamaz.',
    'task.delete.cancel': 'Hayır',
    'task.delete.confirm': 'Evet, Sil',
    'kanban.empty': 'Bu sütunda görev yok',
    'stats.title': 'Görev İstatistikleri',
    'stats.filters.week': 'Bu Hafta',
    'stats.filters.month': 'Bu Ay',
    'stats.filters.all': 'Tümü',
    'stats.section.distribution': 'Görev Durum Dağılımı',
    'stats.section.ratios': 'Oranlar',
    'stats.empty': 'Bu dönemde görev bulunmuyor',
    'stats.legend.completed': 'Tamamlandı',
    'stats.legend.inProgress': 'Devam Ediyor',
    'stats.legend.todo': 'Yapılacak',
    'stats.count.completed': 'Tamamlanan Görev',
    'stats.count.inProgress': 'Devam Eden Görev',
    'stats.count.todo': 'Yapılacak Görev',
    'stats.count.total': 'Toplam',
    'profile.title': 'Profil Ayarları',
    'profile.tabs.profile': 'Profil',
    'profile.tabs.notifications': 'Bildirimler',
    'profile.tabs.privacy': 'Gizlilik',
    'profile.tabs.security': 'Güvenlik',
    'profile.tabs.stats': 'İstatistikler',
    'profile.personalInfo': 'Kişisel Bilgiler',
    'profile.buttons.edit': 'Düzenle',
    'profile.buttons.cancel': 'İptal',
    'profile.buttons.save': 'Kaydet',
    'profile.buttons.saving': 'Kaydediliyor...',
    'profile.fields.name': 'Ad Soyad',
    'profile.fields.email': 'E-posta',
    'profile.fields.phone': 'Telefon',
    'profile.tiles.joinedDate': 'Katılım Tarihi',
    'profile.tiles.lastActive': 'Son Aktivite',
    'profile.tiles.timezone': 'Saat Dilimi',
    'profile.stats.title': 'İstatistikler',
    'profile.stats.cards.total': 'Toplam Görev',
    'profile.stats.cards.completed': 'Tamamlanan',
    'profile.stats.cards.inProgress': 'Devam Eden',
    'profile.stats.cards.overdue': 'Geciken',
    'profile.stats.performance.title': 'Performans',
    'profile.stats.performance.score': 'Verimlilik Skoru',
    'profile.stats.performance.streak': 'Seri Günler',
    'profile.stats.performance.days': 'gün',
    'profile.stats.categories.title': 'Kategoriler',
    'profile.stats.categories.total': 'Toplam Kategori',
    'profile.security.title': 'Güvenlik Ayarları',
    'profile.security.password.title': 'Şifre Değiştirme',
    'profile.security.fields.current': 'Mevcut Şifre',
    'profile.security.fields.new': 'Yeni Şifre',
    'profile.security.fields.confirm': 'Yeni Şifre (Tekrar)',
    'profile.security.update': 'Şifreyi Güncelle',
    'profile.security.updating': 'Kaydediliyor...',
    'profile.security.warning.title': 'Güvenlik Uyarısı',
    'profile.security.warning.text': 'Şifrenizi düzenli olarak değiştirmenizi ve güçlü bir şifre kullanmanızı öneriyoruz.',
    'profile.security.msg.userMissing': 'Kullanıcı bilgisi bulunamadı.',
    'profile.security.msg.fillAll': 'Lütfen tüm alanları doldurun.',
    'profile.security.msg.mismatch': 'Yeni şifre ile doğrulama uyuşmuyor.',
    'profile.security.msg.minLength': 'Yeni şifre en az 6 karakter olmalı.',
    'profile.security.msg.currentWrong': 'Mevcut şifre hatalı.',
    'profile.security.msg.updateFailed': 'Şifre güncellenemedi.',
    'profile.security.msg.updated': 'Şifre başarıyla güncellendi.',
    'profile.security.msg.error': 'Bir hata oluştu. Lütfen tekrar deneyin.',
    'profile.notifications.title': 'Bildirim Ayarları',
    'profile.notifications.email.title': 'E-posta Bildirimleri',
    'profile.notifications.email.general': 'Genel E-posta Bildirimleri',
    'profile.notifications.email.taskReminders': 'Görev Hatırlatıcıları',
    'profile.notifications.email.weeklyReports': 'Haftalık Raporlar',
    'profile.notifications.email.projectUpdates': 'Proje Güncellemeleri',
    'profile.notifications.email.deadlineAlerts': 'Son Tarih Uyarıları',
    'profile.notifications.push.title': 'Push Bildirimleri',
    'profile.notifications.push.pushNotifications': 'Push Bildirimleri',
    'profile.notifications.push.teamMentions': 'Takım Bahsetmeleri',
    'profile.notifications.push.systemUpdates': 'Sistem Güncellemeleri',
    'profile.privacy.title': 'Gizlilik Ayarları',
    'profile.privacy.profileVisibility.title': 'Profil Görünürlüğü',
    'profile.privacy.profileVisibility.profileVisibility': 'Profil Görünürlüğü',
    'profile.privacy.profileVisibility.showEmail': 'E-posta Adresini Göster',
    'profile.privacy.profileVisibility.showActivity': 'Son Aktiviteyi Göster',
    'profile.privacy.profileVisibility.showLocation': 'Konum Bilgisini Göster',
    'profile.privacy.profileVisibility.showOnlineStatus': 'Çevrimiçi Durumunu Göster',
    'profile.privacy.contact.title': 'İletişim',
    'profile.privacy.contact.allowDirectMessages': 'Doğrudan Mesajlara İzin Ver',
    'profile.privacy.contact.showTaskProgress': 'Görev İlerlemesini Göster',
    'help.title': 'Yardım Merkezi',
    'help.sections.gettingStarted.title': 'Başlarken',
    'help.sections.gettingStarted.desc': 'Görev ekleme, düzenleme ve filtreleme gibi temel özelliklerin hızlı özeti.',
    'help.sections.account.title': 'Hesap ve Güvenlik',
    'help.sections.account.desc': 'Giriş, oturum ve şifre değiştirme ile ilgili sık sorulanlar.',
    'help.sections.advanced.title': 'İleri Özellikler',
    'help.sections.advanced.desc': 'Takvim, Kanban ve İstatistik görünümlerini verimli kullanma.',
    'help.faq.title': 'Sık Sorulan Sorular',
    'help.faq.q1': 'Görev nasıl eklerim?',
    'help.faq.a1': 'Sağ üstteki “Yeni Görev” butonuna tıklayın. Açılan modaldan başlık, açıklama, tarih ve önceliği girip Kaydet’e basın.',
    'help.faq.q2': 'Görünümü nasıl değiştiririm?',
    'help.faq.a2': 'Sol menüden Liste/Tahta/Takvim/İstatistik görünümlerini seçebilirsiniz. Varsayılan görünümü Ayarlar > Varsayılan Görünüm’den kalıcı olarak ayarlayın.',
    'help.faq.q3': 'Şifremi nasıl değiştiririm?',
    'help.faq.a3': 'Ayarlar > Güvenlik bölümünde mevcut şifrenizle doğrulayıp yeni şifreyi belirleyin.',
    'help.faq.q4': 'Dil ve tema nereden değişir?',
    'help.faq.a4': 'Üst menüdeki kısayollardan ya da Ayarlar sayfasındaki Dil/Tema bölümlerinden değiştirebilirsiniz.',
    'help.faq.q5': 'Verilerim nerede saklanıyor?',
    'help.faq.a5': 'Verileriniz bulutta güvenle saklanır. Oturum bilgileriniz yenilemede korunur.',
    'help.tips.title': 'İpuçları',
    'help.tips.1': 'Filtre çubuğunu kullanarak görevleri hızla daraltın.',
    'help.tips.2': 'Kanban tahtasında sürükle-bırak ile durumu güncelleyin.',
    'help.tips.3': 'Takvim görünümünde teslim tarihlerini görsel olarak takip edin.',
    'help.support.title': 'Destek',
    'help.support.desc': 'Sorun mu yaşıyorsunuz? Aşağıdaki kanallardan ulaşın:',
    'help.support.emailNote': 'Geri bildirimleriniz, ürünü geliştirmemize yardımcı olur.',
  },
  en: {
    'common.loading': 'Loading...',
    'common.language': 'Language',
    'common.light': 'Light',
    'common.dark': 'Dark',
    'header.newTask': 'New Task',
    'header.profile': 'Profile',
    'header.settings': 'Settings',
    'header.notifications': 'Notifications',
    'header.help': 'Help',
    'header.logout': 'Log Out',
    'sidebar.list': 'List',
    'sidebar.board': 'Board',
    'sidebar.calendar': 'Calendar',
    'sidebar.stats': 'Statistics',
    'sidebar.total': 'Total',
    'sidebar.completed': 'Completed',
    'sidebar.inProgress': 'In Progress',
    'sidebar.todo': 'To Do',
    'settings.title': 'Settings',
    'settings.language': 'Language',
    'settings.theme': 'Theme',
    'settings.defaultView': 'Default View',
    'settings.defaultViewHelp': 'Your selection applies immediately and will be saved for next sessions.',
    'settings.notifications': 'Notifications',
    'settings.security': 'Security',
    'settings.reports.weekly': 'Weekly Reports',
    'settings.push': 'Push Notifications',
    'settings.email': 'Email Reminders',
    'notifications.title': 'Notifications',
    'notifications.total': 'Total',
    'notifications.unread': 'Unread',
    'notifications.empty': 'No notifications to display.',
    'notifications.onlyUnread': 'Only unread',
    'notifications.all': 'All',
    'notifications.markAllRead': 'Mark all as read',
    'notifications.markRead': 'Mark as read',
    'notifications.markUnread': 'Mark as unread',
    'filter.searchPlaceholder': 'Search tasks...',
    'filter.filters': 'Filters',
    'filter.status': 'Status',
    'filter.priority': 'Priority',
    'filter.date': 'Date',
    'filter.status.all': 'All Statuses',
    'filter.status.todo': 'To Do',
    'filter.status.inProgress': 'In Progress',
    'filter.status.completed': 'Completed',
    'kanban.todo': 'To Do',
    'kanban.inProgress': 'In Progress',
    'kanban.completed': 'Completed',
    'filter.priority.all': 'All Priorities',
    'filter.priority.high': 'High',
    'filter.priority.medium': 'Medium',
    'filter.priority.low': 'Low',
    'filter.date.all': 'All Dates',
    'filter.date.today': 'Today',
    'filter.date.week': 'This Week',
    'filter.date.month': 'This Month',
    'taskModal.newTitle': 'New Task',
    'taskModal.editTitle': 'Edit Task',
    'taskModal.field.title': 'Task Title',
    'taskModal.field.description': 'Description',
    'taskModal.field.priority': 'Priority',
    'taskModal.field.status': 'Status',
    'taskModal.field.dueDate': 'Due Date',
    'taskModal.field.category': 'Category',
    'taskModal.placeholder.title': 'Enter task title...',
    'taskModal.placeholder.description': 'Enter task description...',
    'taskModal.placeholder.category': 'Enter category...',
    'taskModal.placeholder.selectPriority': 'Select priority',
    'taskModal.placeholder.selectStatus': 'Select status',
    'taskModal.error.titleRequired': 'Task title is required',
    'taskModal.error.dueDateRequired': 'Due date is required',
    'taskModal.error.priorityRequired': 'Priority is required',
    'taskModal.error.statusRequired': 'Status is required',
    'taskModal.cancel': 'Cancel',
    'taskModal.create': 'Create',
    'taskModal.update': 'Update',
    'task.delete.title': 'Are you sure you want to delete this task?',
    'task.delete.subtitle': 'This action cannot be undone.',
    'task.delete.cancel': 'No',
    'task.delete.confirm': 'Yes, Delete',
    'kanban.empty': 'No tasks in this column',
    'stats.title': 'Task Statistics',
    'stats.filters.week': 'This Week',
    'stats.filters.month': 'This Month',
    'stats.filters.all': 'All',
    'stats.section.distribution': 'Task Status Distribution',
    'stats.section.ratios': 'Ratios',
    'stats.empty': 'No tasks in this period',
    'stats.legend.completed': 'Completed',
    'stats.legend.inProgress': 'In Progress',
    'stats.legend.todo': 'To Do',
    'stats.count.completed': 'Completed Tasks',
    'stats.count.inProgress': 'In-progress Tasks',
    'stats.count.todo': 'To-do Tasks',
    'stats.count.total': 'Total',
    'profile.title': 'Profile Settings',
    'profile.tabs.profile': 'Profile',
    'profile.tabs.notifications': 'Notifications',
    'profile.tabs.privacy': 'Privacy',
    'profile.tabs.security': 'Security',
    'profile.tabs.stats': 'Statistics',
    'profile.personalInfo': 'Personal Information',
    'profile.buttons.edit': 'Edit',
    'profile.buttons.cancel': 'Cancel',
    'profile.buttons.save': 'Save',
    'profile.buttons.saving': 'Saving...',
    'profile.fields.name': 'Full Name',
    'profile.fields.email': 'Email',
    'profile.fields.phone': 'Phone',
    'profile.tiles.joinedDate': 'Joined Date',
    'profile.tiles.lastActive': 'Last Active',
    'profile.tiles.timezone': 'Time Zone',
    'profile.stats.title': 'Statistics',
    'profile.stats.cards.total': 'Total Tasks',
    'profile.stats.cards.completed': 'Completed',
    'profile.stats.cards.inProgress': 'In Progress',
    'profile.stats.cards.overdue': 'Overdue',
    'profile.stats.performance.title': 'Performance',
    'profile.stats.performance.score': 'Productivity Score',
    'profile.stats.performance.streak': 'Streak Days',
    'profile.stats.performance.days': 'days',
    'profile.stats.categories.title': 'Categories',
    'profile.stats.categories.total': 'Total Categories',
    'profile.security.title': 'Security Settings',
    'profile.security.password.title': 'Change Password',
    'profile.security.fields.current': 'Current Password',
    'profile.security.fields.new': 'New Password',
    'profile.security.fields.confirm': 'New Password (Confirm)',
    'profile.security.update': 'Update Password',
    'profile.security.updating': 'Saving...',
    'profile.security.warning.title': 'Security Notice',
    'profile.security.warning.text': 'We recommend changing your password regularly and using a strong one.',
    'profile.security.msg.userMissing': 'User info not found.',
    'profile.security.msg.fillAll': 'Please fill in all fields.',
    'profile.security.msg.mismatch': 'New password and confirmation do not match.',
    'profile.security.msg.minLength': 'New password must be at least 6 characters.',
    'profile.security.msg.currentWrong': 'Current password is incorrect.',
    'profile.security.msg.updateFailed': 'Password could not be updated.',
    'profile.security.msg.updated': 'Password updated successfully.',
    'profile.security.msg.error': 'An error occurred. Please try again.',
    'profile.notifications.title': 'Notification Settings',
    'profile.notifications.email.title': 'Email Notifications',
    'profile.notifications.email.general': 'General Email Notifications',
    'profile.notifications.email.taskReminders': 'Task Reminders',
    'profile.notifications.email.weeklyReports': 'Weekly Reports',
    'profile.notifications.email.projectUpdates': 'Project Updates',
    'profile.notifications.email.deadlineAlerts': 'Deadline Alerts',
    'profile.notifications.push.title': 'Push Notifications',
    'profile.notifications.push.pushNotifications': 'Push Notifications',
    'profile.notifications.push.teamMentions': 'Team Mentions',
    'profile.notifications.push.systemUpdates': 'System Updates',
    'profile.privacy.title': 'Privacy Settings',
    'profile.privacy.profileVisibility.title': 'Profile Visibility',
    'profile.privacy.profileVisibility.profileVisibility': 'Profile Visibility',
    'profile.privacy.profileVisibility.showEmail': 'Show Email Address',
    'profile.privacy.profileVisibility.showActivity': 'Show Last Activity',
    'profile.privacy.profileVisibility.showLocation': 'Show Location',
    'profile.privacy.profileVisibility.showOnlineStatus': 'Show Online Status',
    'profile.privacy.contact.title': 'Contact',
    'profile.privacy.contact.allowDirectMessages': 'Allow Direct Messages',
    'profile.privacy.contact.showTaskProgress': 'Show Task Progress',
    'help.title': 'Help Center',
    'help.sections.gettingStarted.title': 'Getting Started',
    'help.sections.gettingStarted.desc': 'Quick overview of core features like adding, editing and filtering tasks.',
    'help.sections.account.title': 'Account & Security',
    'help.sections.account.desc': 'FAQs about sign-in, session and changing password.',
    'help.sections.advanced.title': 'Advanced Features',
    'help.sections.advanced.desc': 'Use Calendar, Kanban and Statistics effectively.',
    'help.faq.title': 'Frequently Asked Questions',
    'help.faq.q1': 'How do I add a task?',
    'help.faq.a1': 'Click the “New Task” button in the header. In the modal, enter title, description, date and priority, then save.',
    'help.faq.q2': 'How do I change the view?',
    'help.faq.a2': 'Use the left menu to select List/Board/Calendar/Statistics. Set the default in Settings > Default View.',
    'help.faq.q3': 'How do I change my password?',
    'help.faq.a3': 'In Settings > Security, verify with your current password and set a new one.',
    'help.faq.q4': 'Where do I change language and theme?',
    'help.faq.a4': 'Use the shortcuts in the header or go to Language/Theme sections in Settings.',
    'help.faq.q5': 'Where is my data stored?',
    'help.faq.a5': 'Your data is securely stored in the cloud. Your session persists on refresh.',
    'help.tips.title': 'Tips',
    'help.tips.1': 'Use the filter bar to quickly narrow tasks.',
    'help.tips.2': 'Update status via drag-and-drop on the Kanban board.',
    'help.tips.3': 'Track due dates visually in the calendar view.',
    'help.support.title': 'Support',
    'help.support.desc': 'Having issues? Reach us via:',
    'help.support.emailNote': 'Your feedback helps us improve the product.',
  },
};

const I18nContext = createContext<I18nContextValue | undefined>(undefined);

export function I18nProvider({ children }: { children: ReactNode }) {
  const [lang, setLang] = useState<LanguageCode>(() => (localStorage.getItem('lang') as LanguageCode) || 'tr');

  useEffect(() => {
    localStorage.setItem('lang', lang);
  }, [lang]);

  const value = useMemo<I18nContextValue>(() => ({
    lang,
    t: (key: string) => messages[lang][key] ?? key,
    setLanguage: setLang,
  }), [lang]);

  return (
    <I18nContext.Provider value={value}>
      {children}
    </I18nContext.Provider>
  );
}

export function useI18n() {
  const ctx = useContext(I18nContext);
  if (!ctx) throw new Error('useI18n must be used within I18nProvider');
  return ctx;
}


